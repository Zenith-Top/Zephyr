import{a as A}from"./stimulus-helpers-Bg5ApOVk-1.js";import{a as T}from"./js-Cz0CWeBA-1.js";import b from"./ez-base-controller-DuL8VR07-1.js";import{e as l}from"./events-BkNvg-Hc-1.js";import{G as L,h as C,t as c,H as p,I as E,j as g,J as v,K as F,n as u,b as k}from"./helpers-SiW2vY12-1.js";import{F as I}from"./filters-state-BjbyzNKW-1.js";import{S as _}from"./scroll-position-helpers-CGL_xFnA-1.js";import{sendTrackingEvent as h,trackCompleteEvent as w}from"./tracking-wc8XaWQf-1.js";import{S as P,K as q,L as x,M as R,N as z,O as H}from"./actions-DEzMaOTc-1.js";import{a as y}from"./index-C4xxlH8f-1.js";import"./stimulus-Cq41p_up-1.js";import"./init-user-BlDnuGFC-1.js";import"./_commonjsHelpers-BosuxZz1-1.js";const d=class d extends b{constructor(){super(...arguments),this.navigationKeyCodes=["ArrowUp","ArrowLeft","ArrowRight","ArrowDown","Enter"],this.exclusionKeyCodes=["MetaLeft","MetaRight","ControlLeft","ControlRight","AltLeft","AltRight","ShiftLeft","ShiftRight"],this.wrapperToggleClasses=["inline-filters","inline-filters__arrow","inline-filters__current"],this.scrollToSearch=()=>{if(this.isMobile()&&L()){const t=this.inputTarget.getBoundingClientRect().top+window.scrollY-20;C(t)}},this.updateSearchSwatch=e=>{const t=e.detail.color;this.searchFormColorSwatches.forEach(i=>{requestAnimationFrame(()=>{i.parentElement.classList.add("ez-search-form__searched-color--active"),i.style.backgroundColor=`#${t}`})})},this.resetColorSwatchFilter=()=>{this.searchFormColorSwatches.forEach(e=>{requestAnimationFrame(()=>{e.parentElement.classList.remove("ez-search-form__searched-color--active"),e.style.backgroundColor=""})}),c("resetColorSwatchFilter")},this.resizeInput=()=>{this.inputTarget.value?requestAnimationFrame(()=>{this.hiddenInputHolderTarget.textContent=this.inputTarget.value}):requestAnimationFrame(()=>{this.inputTarget.placeholder=this.savedPlaceholder||this.inputTarget.placeholder,this.inputTarget.setAttribute("aria-label",this.savedPlaceholder||this.inputTarget.placeholder),this.hiddenInputHolderTarget.textContent=this.inputTarget.placeholder}),p()&&this.repositionColorSwatch()},this.repositionColorSwatch=()=>{var e;(e=this.searchFormColorSwatches)==null||e.forEach(t=>{t.parentElement&&requestAnimationFrame(()=>{t.parentElement.style.left=`${this.hiddenInputWidth||1}px`,t.parentElement.classList.remove("is-hidden")})})},this.handleInputClick=()=>{this.inputTarget.value.length>=2&&this.queryAutocomplete(this.inputTarget.value)},this.removeAutoFocus=e=>{E(e)||this.element.classList.remove("is-auto-focused")},this.setTogglesFromState=()=>{const e=window.filtersState.getRawParamKeyValues();[...this.element.querySelectorAll(".ez-input--checkbox input")].forEach(i=>{const s=i.closest(".ez-input--checkbox").getAttribute("data-filter-param");e.includes(s)&&this.setActiveFilter(i)})},this.clearPreviousSearches=()=>{window.localStorage.removeItem("previous_searches"),requestAnimationFrame(()=>{this.previousSearchesTarget.classList.add("is-hidden")})},this.handleFilterClick=e=>{this.wrapperToggleClasses.forEach(t=>{e.target.classList.contains(t)&&this.toggleInlineFilters()})},this.setActiveFilter=e=>{const t=[...this.element.querySelectorAll("input")],i=e.closest(".inline-filters__item");t.forEach(s=>{s.checked=!1}),e.checked=!0,requestAnimationFrame(()=>{g()<=635?(this.currentLabelTarget.innerHTML="",this.currentLabelTarget.appendChild(i.querySelector("svg").cloneNode(!0))):this.currentLabelTarget.textContent=i.dataset.selected,this.inputTarget.placeholder=i.dataset.searchSelected,this.inputTarget.setAttribute("aria-label",i.dataset.searchSelected),this.hasPopularSearchesLinkTarget&&(this.popularSearchesLinkTarget.dataset.popularTypes.includes(e.value)?this.popularSearchesTarget.classList.remove("is-hidden"):this.popularSearchesTarget.classList.add("is-hidden"),this.popularSearchesLinkTarget.href=i.dataset.popularSearchPath,this.popularSearchesLinkTarget.textContent=i.dataset.popularSearchText,this.popularSearchesLinkTarget.setAttribute("data-english-label",i.dataset.englishLabel))}),c(l.search.update_content_type,{contentType:e.value})},this.handleFilterOptionClick=e=>{if(this.setActiveFilter(e.target),window.filtersState.omittedFromState(e.target.getAttribute("name"))||window.filtersState.updateParamKey(`${e.target.getAttribute("name")}-${e.target.getAttribute("value")}`),this.toggleInlineFilters(),document.body.classList.contains("searches-show"))v()?F("content_type",e.target.value):window.filtersState.omittedFromState(e.target.getAttribute("name"))?c(l.search.apply_filters,{contentType:e.target.value}):this.submit(e);else{const t=e.target.closest(".inline-filters__item");this.updateContentType(e.target.value,t.dataset.autocompleteContentType),this.autoFocusSearchForm()}this.trackContentTypeSelection(e.target)},this.handlePopularSearchesLinkClick=e=>{this.trackPopularSearchClick(e)},this.toggleInlineFilters=()=>{requestAnimationFrame(()=>{this.inlineFiltersTarget.classList.toggle("is-open")})},this.blurInlineFilters=e=>{this.inlineFiltersTarget.classList.contains("is-open")&&!e.target.closest(".ez-search-form .inline-filters")&&this.toggleInlineFilters()},this.handleInputKeyUp=e=>{!this.exclusionKeyCodes.includes(e.code)&&!this.navigationKeyCodes.includes(e.code)&&this.checkAndToggleIsTyped(),p()&&this.searchFormColorSwatches.forEach(t=>{t.style.backgroundColor!==""&&setTimeout(()=>{t.parentElement.classList.add("ez-search-form__searched-color--active")},600)}),this.navigationKeyCodes.includes(e.code)&&document.querySelector(".ez-search-form__suggestions li")?this.navigateSuggestions(e.code):!this.exclusionKeyCodes.includes(e.code)&&this.inputTarget.value.length>=2?this.queryAutocomplete(this.inputTarget.value):this.autocompleteSuggestionsTarget.innerHTML!==""&&this.resetAutocomplete()},this.handleInputKeyDown=e=>{e.metaKey&&e.code==="Enter"&&this.submit(e)},this.handleSuggestionClick=e=>{this.inputTarget.value=e.currentTarget.textContent,e.currentTarget.parentElement===this.autocompleteSuggestionsTarget&&this.data.set("lastActiveAutocompleteTerm",e.currentTarget.textContent),this.submit(e)},this.navigateSuggestions=e=>{const t=this.autocompleteSuggestionsTarget,i=t.querySelector("li.is-active"),s=this.previousSearchTermsTarget,r=s.querySelector("li.is-active"),a=n=>{let o=this.autocompleteSuggestionsTarget.querySelector("li.is-active");o||(o=this.previousSearchTermsTarget.querySelector("li.is-active")),o&&requestAnimationFrame(()=>{o.classList.remove("is-active")}),n&&(requestAnimationFrame(()=>{n.classList.add("is-active")}),this.data.set("lastActiveAutocompleteTerm",n.textContent),this.inputTarget.value=n.textContent)},S=n=>{this.previousSearchesTarget.classList.contains("is-hidden")?a(n==="navDown"?t.querySelector("li:first-of-type"):t.querySelector("li:last-of-type")):a(s.querySelector("li:first-of-type"))};e==="ArrowUp"?(()=>{r?a(t.querySelector("li:last-of-type")):i&&i.previousSibling?a(i.previousSibling):S("navUp")})():e==="ArrowDown"?(()=>{i&&i.nextSibling?a(i.nextSibling):i&&!i.nextSibling?S("navDown"):a(t.querySelector("li:first-of-type"))})():e==="ArrowRight"?(()=>{r&&(r.nextElementSibling&&(g()<=750||r.getBoundingClientRect().top===r.nextElementSibling.getBoundingClientRect().top)?a(r.nextElementSibling):a(s.querySelector("li:first-of-type")))})():e==="ArrowLeft"?(()=>{if(r)if(r.previousElementSibling)a(r.previousElementSibling);else if(g()<=750)a(s.querySelector("li:last-of-type"));else{const n=r.getBoundingClientRect().top;let o;s.querySelectorAll("li").forEach(f=>f.getBoundingClientRect().top!==n?!1:(o=f,!0)),a(o)}})():e==="Enter"&&this.resetAutocomplete()},this.resetAutocomplete=()=>{this.data.set("lastTerm",""),requestAnimationFrame(()=>{this.autocompleteSuggestionsTarget.innerHTML="",this.formTarget.classList.remove("is-suggesting")})},this.autocompleteUrl=()=>{const e=this.inputTarget.getAttribute("data-autocomplete-content-type").replace("_","-"),t=document.documentElement.getAttribute("lang");return`${this.inputTarget.getAttribute(`data-autocomplete-source-${e}`)??this.inputTarget.dataset.autocompleteSource}${t}`},this.queryAutocomplete=async e=>{if(e===this.data.get("lastTerm"))return;this.data.set("lastTerm",this.inputTarget.value);const t=this.inputTarget.getAttribute("data-content-type"),i=this.autocompleteUrl();try{const r=(await y.get(`${i}?term=${encodeURI(e)}&content_type=${t}`,{headers:{"Content-Type":"text/plain"}})).data.slice(0,6);this.renderAutocomplete(r,e)}catch(s){console.error(s)}}}connect(){var e;window.filtersState=(e=window.filtersState)!=null&&e.isSearchState()?window.filtersState:new I,window.filtersState.addPopStateListener(),window.EezyStickyScrollPositionHelper||(window.EezyStickyScrollPositionHelper=_),this.isMobile()||this.autoFocusSearchForm(),!this.isMobile()&&window.EezyScrollPositionHelper&&window.EezyScrollPositionHelper.allowFocus()&&window.EezyScrollPositionHelper.resetScrollPosition(),p()&&(this.searchFormColorSwatches=document.querySelectorAll('[data-search-form-target="searchedColor"]'),window.addEventListener("updateEzSearchFormColorSwatch",this.updateSearchSwatch)),this.hasInlineFiltersTarget&&this.setupInlineFilters(),this.checkAndToggleIsTyped(),this.inputTarget.addEventListener("blur",this.resizeInput),this.inputTarget.addEventListener("keyup",this.resizeInput),this.inputTarget.addEventListener("keydown",this.resizeInput),this.inputTarget.addEventListener("click",this.removeAutoFocus),this.inputTarget.addEventListener("keydown",this.removeAutoFocus),window.addEventListener(l.search.clear_searches,this.clearPreviousSearches),this.inputTarget.value&&this.resizeInput(),this.setPreviousSearches(),this.inputTarget.addEventListener("click",this.handleInputClick),this.flagLoaded(),this.trackSitelinksSearch(),v&&this.trackSearchSimilarImageComplete()}disconnect(){document.removeEventListener("click",this.blurInlineFilters),this.inputTarget.removeEventListener("blur",this.resizeInput),this.inputTarget.removeEventListener("keyup",this.resizeInput),this.inputTarget.removeEventListener("keydown",this.resizeInput),this.inputTarget.removeEventListener("click",this.removeAutoFocus),this.inputTarget.removeEventListener("keydown",this.removeAutoFocus),window.removeEventListener(l.search.clear_searches,this.clearPreviousSearches),window.removeEventListener("updateEzSearchFormColorSwatch",this.updateSearchSwatch),this.inputTarget.removeEventListener("click",this.handleInputClick)}setupInlineFilters(){this.setLandingPageInlineFilterDefaults(),document.addEventListener("click",this.blurInlineFilters)}get hiddenInputWidth(){return Math.ceil(this.hiddenInputHolderTarget.getBoundingClientRect().width)}autoFocusSearchForm(){const e=this.inputTarget.value;requestAnimationFrame(()=>{this.inputTarget.value="",this.inputTarget.focus(),this.element.classList.add("is-auto-focused"),this.inputTarget.value=e})}setLandingPageInlineFilterDefaults(){document.body.classList.contains("resource-landing")?window.filtersState.resetStateToDefault():this.setTogglesFromState()}setPreviousSearches(){const e=JSON.parse(this.previousSearchTermsTarget.dataset.recentSearches);if(e.length>0){this.addPreviousSearchElements(e,!1);return}const t=window.localStorage.getItem("previous_searches");if(t){const i=JSON.parse(t);this.addPreviousSearchElements(i,!0);return}this.previousSearchesTarget.classList.add("is-hidden")}addPreviousSearchElements(e,t){for(let i=0;i<e.length;i+=1){const s=t?JSON.parse(e[i]):e[i],r=`
        <li class="ez-btn ez-btn--light ez-btn--small" data-action="click->search-form#handleSuggestionClick"
            data-content-type="${s.contentType}">${s.term}</li>`;requestAnimationFrame(()=>{this.previousSearchTermsTarget.insertAdjacentHTML("beforeend",r)})}}handlePreviousClickBlur(e){e.preventDefault()}trackContentTypeSelection(e){h({element:e,data:{action:P,label:e.value,category:document.body.dataset.conversionsCategory}})}updateContentType(e,t){this.inputTarget.setAttribute("data-content-type",e),this.inputTarget.setAttribute("data-autocomplete-content-type",t),c(l.search.update_content_type,{contentType:e})}trackPopularSearchClick(e){const t=this.inputTarget.getAttribute("data-content-type"),i=e.target.getAttribute("data-english-label");h({element:e.target,data:{action:q,label:`Link-${i}`,content_type:`Content-${t}`}})}checkAndToggleIsTyped(){this.searchInputContents?requestAnimationFrame(()=>{this.element.classList.add("is-typed")}):requestAnimationFrame(()=>{this.element.classList.remove("is-typed")})}renderAutocomplete(e,t){if(requestAnimationFrame(()=>{this.formTarget.classList.add("is-suggesting")}),this.autocompleteSuggestionsTarget.innerHTML="",e.length===0){this.resetAutocomplete();return}T.set("last_search_autocomplete_results",JSON.stringify(e),{expires:1}),Object.keys(e).forEach(i=>{const s=document.createElement("LI"),r=e[i].toLowerCase().indexOf(t.toLowerCase());r>=0?requestAnimationFrame(()=>{const a=e[i].substr(r,t.length);s.innerHTML=e[i].replace(new RegExp(t,"ig"),`<strong>${a}</strong>`)}):requestAnimationFrame(()=>{s.innerHTML=e[i]}),s.dataset.action="mousedown->search-form#handleSuggestionClick",requestAnimationFrame(()=>{this.autocompleteSuggestionsTarget.appendChild(s)})})}isMobile(){return document.body.classList.contains("is-mobile")}resetPagination(){const e=window.filtersState.getRawStateObject();Object.prototype.hasOwnProperty.call(e,"page")&&window.filtersState.updateStateValue("page",1)}submitViaButton(e){e.preventDefault(),this.submit(e),this.inputTarget.value.length&&window.requestAnimationFrame(()=>{this.submitTarget.classList.add("is-loading")})}submit(e){if(this.inputTarget.value.length===0||this.element.hasAttribute("data-disable-form-submit"))return;this.resetPagination(),window.filtersState.newSearchDefaultParams.forEach(i=>{window.filtersState.resetKeyToDefault(i)});const t={term:this.inputTarget.value,searchRoute:this.inputTarget.getAttribute("data-search-route"),useSearchState:!0,contentType:this.inputTarget.getAttribute("data-content-type"),searchInNewTab:!1};e.metaKey&&e.code&&e.code==="Enter"&&(t.searchInNewTab=!0),T.set("ezSearchType","internal"),c("Searched",t),this.savePreviousSearch(t),this.trackSearchComplete(),this.inputTarget.value===this.data.get("lastActiveAutocompleteTerm")&&this.trackAutoSuggestSearch(e)}savePreviousSearch(e){let t=JSON.parse(window.localStorage.getItem("previous_searches"));t||(t=[]);for(let i=0;i<t.length;i+=1)if(JSON.parse(t[i]).term===e.term){t.splice(i,1);break}t.unshift(JSON.stringify(e))>6&&t.pop(),window.localStorage.setItem("previous_searches",JSON.stringify(t))}trackManualSearchClick(e){this.element.hasAttribute("data-disable-form-submit")||h({element:e.target,data:{action:x,label:`Terms-${this.inputTarget.value}`,content_type:`Content-${u()}`}})}trackAutoSuggestSearch(e){h({element:e.target,data:{action:R,label:`Terms-${this.inputTarget.value}`,content_type:`Content-${u()}`}}),y.post(`${this.autocompleteUrl()}?original_term=${this.data.get("lastTerm")}&selected_term=${this.data.get("lastActiveAutocompleteTerm")}&content_type=${u()}`)}trackSearchComplete(e=""){const t=[".search-results__meta__results-info",".search-results__header--no-results"];w({action:z,label:`${e}Terms-${this.inputTarget.value}`,valueElementSelector:t,valueAttribute:"search-results-count",dimensions:{content_type:`Content-${u()}`}})}trackSitelinksSearch(){if(!this.element.parentNode.parentElement.classList.contains("ez-site-header")){const e=this.fromSitelinks;e==="sitelinks "&&this.trackSearchComplete(e)}}trackSearchSimilarImageComplete(){new URLSearchParams(window.location.search).get("similar_image_search")==="true"&&w({action:H,dimensions:{content_type:"Content-image"}})}get resultsCount(){const e=document.querySelector("[data-search-results-count]");return e?e.getAttribute("data-search-results-count"):null}get pageNumber(){const e=k();return e||"1"}get searchInputContents(){return this.inputTarget.value}get fromSitelinks(){const t=new URLSearchParams(window.location.search).get("referral");return!t||t!=="sitelinks_searchbox"?"":"sitelinks "}};d.targets=["form","input","submit","currentLabel","popularSearches","popularSearchesLink","inlineFilters","previousSearches","hiddenInputHolder","previousSearchTerms","autocompleteSuggestions"];let m=d;A({name:"search-form",import:m});export{m as default};

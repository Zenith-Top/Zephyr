import{a as c}from"./stimulus-helpers-Bg5ApOVk-1.js";import{C as d}from"./stimulus-Cq41p_up-1.js";import{a as n}from"./js-Cz0CWeBA-1.js";import{e as a}from"./events-BkNvg-Hc-1.js";import{J as i}from"./helpers-SiW2vY12-1.js";import"./init-user-BlDnuGFC-1.js";class l extends d{constructor(){super(...arguments),this.sendSearchClick=e=>{const r=this.searchClickData(e);this.sendBeacon("/api/v2/tracking/search/clicks",r),window.localStorage.setItem(`resource-${e.detail.resourceId}`,JSON.stringify(r))},this.sendSponsoredSearchClick=e=>{const r=this.searchSponsoredClickData(e);this.sendBeacon("/api/v2/tracking/search/sponsored_clicks",r)},this.sendSearchDownload=e=>{const r=this.searchDownloadData(e);r&&this.sendBeacon("/api/v2/tracking/search/downloads",r)}}connect(){i()||(window.addEventListener(a.search.click,this.sendSearchClick),window.addEventListener(a.search.sponsored_click,this.sendSponsoredSearchClick),window.addEventListener(a.download_btn.initial_click,this.sendSearchDownload)),this.sendPageView()}disconnect(){window.removeEventListener(a.search.click,this.sendSearchClick),window.removeEventListener(a.search.sponsored_click,this.sendSponsoredSearchClick),window.removeEventListener(a.download_btn.initial_click,this.sendSearchDownload)}sendBeacon(e,r){if(document.body.getAttribute("data-env")==="test"){const s=n.get("searchEventsSent")||"[]",o=JSON.parse(s);o.push({url:e,data:r}),n.set("searchEventsSent",JSON.stringify(o),{domain:".example.com"});return}const t=new FormData;t.append(this.csrfParam,this.csrfToken),Object.keys(r).forEach(s=>{t.append(s,r[s])}),window.navigator.sendBeacon(e,t)}sendPageView(){this.isSearchResultsPage&&(i()||this.sendBeacon("/api/v2/tracking/search/pageviews",this.pageViewData))}get csrfParam(){const e=document.querySelector("meta[name=csrf-param]");return e?e.content:null}get csrfToken(){const e=document.querySelector("meta[name=csrf-token]");return e?e.content:null}get isSearchResultsPage(){return!!document.querySelector("[data-search-results-count]")}get pageViewData(){const e=["algo_version","content_type","domain","filters_used","filter_params_json","guid","ignore","internal","locale","page","pageview_guid","pro","referrer","results_count","split_test_name","split_test_variant","term","total_free_results","total_pro_results","type","user_guid","browser_language"],r={};return e.forEach(t=>{r[t]=this.element.getAttribute(`data-search-${t.replace(/_/g,"-")}`)||""}),r}searchClickData(e){const r=this.pageViewData;return r.resource_id=e.detail.resourceId,r.resource_position=e.detail.resourcePosition,r.resource_pro=e.detail.resourcePro,r}searchSponsoredClickData(e){const r=this.pageViewData;return r.resource_id=e.detail.resourceId,r.resource_position=e.detail.resourcePosition,r.resource_pro=e.detail.resourcePro,r.sponsored=e.detail.sponsored,r}searchDownloadData(e){if(!e.detail.guid)return null;const r={};return Object.entries(e.detail).forEach(([t,s])=>{r[t]=s}),r}}c({name:"search-analytics",import:l});export{l as default};

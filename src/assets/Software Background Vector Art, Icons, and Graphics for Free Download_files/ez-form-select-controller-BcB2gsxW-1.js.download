import{a}from"./stimulus-helpers-Bg5ApOVk-1.js";import u from"./ez-base-controller-DuL8VR07-1.js";import{E as r}from"./ez-custom-events-B9oXrnTo-1.js";import{t as d}from"./helpers-SiW2vY12-1.js";import{R as h}from"./rails-ujs-DLwK8N9E-1.js";import"./stimulus-Cq41p_up-1.js";import"./js-Cz0CWeBA-1.js";import"./init-user-BlDnuGFC-1.js";const n=class n extends u{constructor(){super(...arguments),this.wrapperToggleClasses=["ez-form-select-field__current"],this.blurSubMenus=e=>{const t=document.querySelectorAll(".ez-form-select-field.is-open"),i=e.target.closest(".ez-form-select-field");t&&t.forEach(s=>{i!==s&&d(r,{},s)})},this.navigateSelect=e=>{var t,i;this.element.classList.contains("is-open")&&(e.key==="ArrowDown"?(e.stopPropagation(),e.preventDefault(),this.setFocusedOption((t=this.focusedOption)==null?void 0:t.nextSibling)):e.key==="ArrowUp"?(e.stopPropagation(),e.preventDefault(),this.setFocusedOption((i=this.focusedOption)==null?void 0:i.previousSibling)):e.key==="Enter"&&(this.focusedOption.click(),this.closeDropDown()))},this.setSelected=e=>{const{value:t}=e.params,i=e.target.textContent;if(this.isMultiSelect()){const s=this.valueFieldTarget;for(;s.options.length;)s.remove(0);this.isMultiChecked(e.target)?this.selectedValue=this.selectedValue.filter(l=>l.value!==t):this.selectedValue=this.selectedValue.concat({text:i,value:t}),this.selectedValue.length>0&&this.selectedValue.forEach(l=>{const o=document.createElement("option");o.text=l.text,o.value=l.value,o.setAttribute("selected","true"),s.add(o)})}else this.valueFieldTarget.value=t==="all"?"":t;this.valueFieldTarget.dispatchEvent(new Event("change")),this.selectSubmitValue&&this.submitForm()},this.handleSelectOptionClick=e=>{this.setSelected(e),this.isMultiSelect()&&(this.isMultiChecked(e.target)?e.target.classList.remove("is-checked"):e.target.classList.add("is-checked")),this.hasInputFieldTarget?this.isMultiSelect()?this.inputFieldTarget.value=this.multiSelectLabel():(this.inputFieldTarget.value=e.target.textContent,this.inputFieldTarget.dispatchEvent(new Event("input"))):this.currentLabelTarget.textContent=e.target.textContent,this.toggleDropDown(this.element)},this.closeDropDown=()=>{this.element.classList.remove("is-open"),document.removeEventListener("keydown",this.navigateSelect)},this.allowEscClose=e=>{e.keyCode===27&&this.blurSubMenus(e)}}connect(){this.isMultiSelect()&&(this.selectedValue=[]),this.element.addEventListener(r,this.closeDropDown),window.addEventListener("keyup",this.allowEscClose),document.addEventListener("click",this.blurSubMenus)}disconnect(){this.element.removeEventListener(r,this.closeDropDown),window.removeEventListener("keyup",this.allowEscClose),document.removeEventListener("click",this.blurSubMenus)}handleSelectClick(e){this.blurSubMenus(e),this.toggleDropDown(this.element);const t=this.valueFieldTarget.value;this.setFocusedOption(this.element.querySelector(`.ez-form-select-field__item[data-ez-form-select-value-param="${t}"]`)||this.element.querySelector(".ez-form-select-field__item:first-of-type")),document.addEventListener("keydown",this.navigateSelect),this.element.focus()}setFocusedOption(e){if(!(e&&e instanceof HTMLElement))return;requestAnimationFrame(()=>{var s;(s=this.focusedOption)==null||s.classList.remove("is-focused"),this.focusedOption=e,e.classList.add("is-focused")});const{scrollX:t,scrollY:i}=window;e.scrollIntoView({container:"nearest",block:"end"}),window.scrollTo(t,i)}submitForm(){const e=this.element.closest("form");e.getAttribute("data-remote")==="true"?h.fire(e,"submit"):e.submit()}toggleDropDown(e){e.classList.toggle("is-open"),e.classList.contains("is-open")||document.removeEventListener("keydown",this.navigateSelect)}isMultiSelect(){return this.element.classList.contains("ez-form-select-field--multi")}isMultiChecked(e){return e.classList.contains("is-checked")}multiExistingValue(e){return e&&typeof e<"u"&&JSON.parse(e)instanceof Array?JSON.parse(e):[]}multiSelectLabel(){return this.selectedValue.map(e=>e.text).join(", ")}};n.targets=["currentLabel","valueField","inputField"],n.values={selectSubmit:Boolean};let c=n;a({name:"ez-form-select",import:c});export{c as default};

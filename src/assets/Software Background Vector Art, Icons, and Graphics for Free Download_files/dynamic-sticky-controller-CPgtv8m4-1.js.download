import{a as d}from"./stimulus-helpers-Bg5ApOVk-1.js";import S from"./ez-base-controller-DuL8VR07-1.js";import{G as a}from"./ez-custom-events-B9oXrnTo-1.js";import{M as u}from"./media-matcher-vK8K0PVe-1.js";import"./stimulus-Cq41p_up-1.js";function c(h){let e;return(...t)=>{e&&cancelAnimationFrame(e),e=requestAnimationFrame(()=>{h(...t)})}}const r=new u,s=class s extends S{constructor(){super(...arguments),this.lastScrolledPosition=window.scrollY,this.isScrolled=!1,this.setupSticky=()=>{this.setupStickyMediaQueries(),this.initialState(),window.addEventListener("scroll",this.normalScrollCheck)},this.initialState=()=>{this.stickElement(),this.showElement(),this.isCloseToTop()&&this.hideStickyHeaderSearchBar(),window.addEventListener("scroll",this.dynamicScrollCheck)},this.disableDynamicSticky=()=>{this.stickElement(),this.showElement(),window.removeEventListener("scroll",this.dynamicScrollCheck)},this.isScrollingUp=()=>this.lastScrolledPosition>window.scrollY,this.isScrolledToTop=()=>window.scrollY<=0,this.isCloseToTop=(e=!1)=>{const t=this.element,i=e?50:0;return window.scrollY<=t.offsetHeight+i},this.hasScrolledPastLastStickyElement=()=>{const e=document.querySelectorAll('[data-controller*="dynamic-sticky"]'),i=Array.from(e).reduce((l,o)=>{const m=l.offsetTop+l.offsetHeight;return o.offsetTop+o.offsetHeight>m?o:l});return window.scrollY>i.clientHeight},this.showElement=()=>{this.element.classList.contains(this.isStickyClass)&&requestAnimationFrame(()=>{this.element.classList.remove(this.hideElementClass),this.element.classList.add(this.showElementClass),this.showStickyHeaderSearchBar(),this.applyStickyOffset()})},this.hideElement=()=>{requestAnimationFrame(()=>{this.element.classList.remove(this.showElementClass),this.element.classList.add(this.hideElementClass),this.removeStickyOffset()})},this.unstickElement=()=>{requestAnimationFrame(()=>{this.element.classList.remove(this.showElementClass),this.element.classList.remove(this.isStickyClass)})},this.stickElement=()=>{this.element.classList.add(this.isStickyClass)},this.showStickyHeaderSearchBar=(e=!1)=>{this.mainSearchBar&&(!this.isCloseToTop(!0)||e)&&requestAnimationFrame(()=>{this.mainSearchBar.classList.add("is-visible"),requestAnimationFrame(()=>{this.searchField.disabled=!1})})},this.applyStickyOffset=()=>{if(!this.hasOffsetElementSelectorValue)return;const e=document.querySelector(this.offsetElementSelectorValue),t=this.element;requestAnimationFrame(()=>{t.style.top=`${e.offsetHeight}px`})},this.removeStickyOffset=()=>{requestAnimationFrame(()=>{this.element.style.top="0"})},this.applyStickyHeader=()=>{this.isScrollingUp()?this.scrollingUpActions():this.scrollingDownActions(),this.lastScrolledPosition=window.scrollY},this.scrollingUpActions=()=>{this.showElement(),this.isScrolledToTop()&&this.unstickElement(),this.isCloseToTop()&&this.hideStickyHeaderSearchBar()},this.scrollingDownActions=()=>{this.hasScrolledPastLastStickyElement()&&(this.stickElement(),this.hideElement())},this.checkScroll=()=>{window.scrollY>this.scrollOffsetValue&&this.isScrolled===!1?(requestAnimationFrame(()=>{document.body.classList.add("is-scrolled")}),this.isScrolled=!0):window.scrollY<=0&&this.isScrolled===!0&&(requestAnimationFrame(()=>{document.body.classList.remove("is-scrolled")}),this.isScrolled=!1)},this.normalScrollCheck=c(this.checkScroll),this.dynamicScrollCheck=c(()=>{this.applyStickyHeader()})}connect(){this.waitToGetSticky()?window.addEventListener(a,this.setupSticky):this.setupSticky(),window.addEventListener("resize",this.applyStickyOffset)}disconnect(){window.removeEventListener(a,this.setupSticky),window.removeEventListener("resize",this.applyStickyOffset),window.removeEventListener("scroll",this.normalScrollCheck),window.removeEventListener("scroll",this.dynamicScrollCheck)}setupStickyMediaQueries(){r.addMediaQuery("(max-width: 635px)",()=>this.showStickyHeaderSearchBar(!0),this.initialState),r.evaluateAll(),r.addListeners()}hideStickyHeaderSearchBar(){!this.mobileSearchButtonVisible()&&document.body.classList.contains("main-search-soft-hidden")&&this.mainSearchBar&&requestAnimationFrame(()=>{this.mainSearchBar.classList.remove("is-visible"),requestAnimationFrame(()=>{this.searchField.disabled=!0})})}mobileSearchButtonVisible(){const e=document.querySelector('[data-action*="click->site-header#toggleMobileSearch"]');return e?getComputedStyle(e).display!=="none":!1}waitToGetSticky(){return window.waitToGetSticky||this.waitToInitValue}get mainSearchBar(){return document.querySelector(".ez-site-header__search-fullwidth")}get searchField(){return this.mainSearchBar.querySelector(".ez-search-form__input")}};s.classes=["isSticky","showElement","hideElement"],s.values={mobileOnly:{type:Number,default:0},waitToInit:{type:Boolean,default:!1},offsetElementSelector:String,scrollOffset:{type:Number,default:0}};let n=s;d({name:"dynamic-sticky",import:n});export{n as default};

import{a}from"./stimulus-helpers-Bg5ApOVk-1.js";import l from"./ez-base-controller-DuL8VR07-1.js";import{z as u}from"./helpers-SiW2vY12-1.js";import{sendTrackingEvent as i}from"./tracking-wc8XaWQf-1.js";import{b0 as c,am as h}from"./actions-DEzMaOTc-1.js";import{e as d,a as r}from"./button-helpers-CvZG-X-W-1.js";import"./stimulus-Cq41p_up-1.js";import"./js-Cz0CWeBA-1.js";import"./init-user-BlDnuGFC-1.js";const s=class s extends l{constructor(){super(...arguments),this.removeEventListeners=()=>{const e=setInterval(()=>{this.followEventFinished&&(this.element.removeEventListener("ajax:success",this.updateFollowStatus),this.element.removeEventListener("ajax:error",this.initiateFollowChange),clearInterval(e))},100)},this.followAfterLogin=()=>{u("follow_after_login",this.element.dataset.userId),i({data:{category:"Trigger-Contributor_Follow",action:h}}),this.trackContributorFollow({target:this.element})},this.initiateFollowChange=()=>{this.selectedContributorId=this.element.dataset.userId,this.contributorsDataElement=document.querySelector("[data-contributors-info]"),this.contributorsDataElement&&document.body.setAttribute("data-updating-follow-status",this.selectedContributorId),document.querySelectorAll(`[data-follow-button-target="followButton"][data-user-id="${this.selectedContributorId}"]`).forEach(t=>{t.classList.toggle("is-following"),d(t)})},this.updateFollowStatus=()=>{this.contributorsDataElement?(this.updateContributorsInfoElement(),this.updateFollowButtonsWithContributorsInfo()):this.simpleToggleFollowButton()},this.simpleToggleFollowButton=()=>{const e=this.element.href,t=this.textWrapTarget.innerHTML;this.textWrapTarget.innerHTML=this.element.dataset.switchText,this.element.dataset.switchText=t,this.element.href=this.element.dataset.switchHref,this.element.dataset.switchHref=e,r(this.element)},this.updateContributorsInfoElement=()=>{this.contributorsData=JSON.parse(this.contributorsDataElement.dataset.contributorsInfo),this.element.classList.remove("has-spinner");const e={follow_button_text:this.contributorsData[this.selectedContributorId].follow_button_switch_text,follow_button_switch_text:this.contributorsData[this.selectedContributorId].follow_button_text,follow_button_action:this.contributorsData[this.selectedContributorId].follow_button_switch_action,follow_button_switch_action:this.contributorsData[this.selectedContributorId].follow_button_action,follow_button_class:this.element.className};Object.assign(this.contributorsData[this.selectedContributorId],e),this.contributorsDataElement.dataset.contributorsInfo=JSON.stringify(this.contributorsData),document.body.removeAttribute("data-updating-follow-status")},this.updateFollowButtonsWithContributorsInfo=()=>{document.querySelectorAll(`[data-follow-button-target="followButton"][data-user-id="${this.selectedContributorId}"]`).forEach(t=>{const n=t.querySelector(".ez-spinner--sm");t.classList.remove("has-spinner"),t.querySelector('[data-follow-button-target="textWrap"]').innerHTML=this.contributorsData[this.selectedContributorId].follow_button_text,t.switchText=this.contributorsData[this.selectedContributorId].follow_button_switch_text,t.href=this.contributorsData[this.selectedContributorId].follow_button_action,t.className=this.contributorsData[this.selectedContributorId].follow_button_class,n&&r(t)})},this.trackContributorFollow=e=>{i({element:e.target,data:{action:c,category:"Contributor"}})}}connect(){this.element.dataset.action&&this.element.dataset.action!=="follow-button#followAfterLogin"&&(this.element.addEventListener("ajax:success",this.updateFollowStatus),this.element.addEventListener("ajax:error",this.initiateFollowChange)),this.flagLoaded()}disconnect(){this.removeEventListeners()}get followEventFinished(){return!document.body.hasAttribute("data-updating-follow-status")}getUsername(){const e=document.querySelector(".user-profile"),t=document.querySelector(".ez-resource-show__contributor");return(e==null?void 0:e.getAttribute("data-profile-username"))||(t==null?void 0:t.getAttribute("data-contributor-name"))}};s.targets=["textWrap","followButton"];let o=s;a({name:"follow-button",import:o});export{o as default};
